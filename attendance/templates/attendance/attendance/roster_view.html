{% extends 'index.html' %}
{% block content %}
{% load i18n %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roster Management</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f8fafc;
            color: #334155;
            line-height: 1.5;
        }

        .container {
            height: 89vh;
            display: flex;
            flex-direction: column;
            max-width: 1300px;
            margin: 0 auto;
            padding: 10px;
            background: #f8fafc;
            gap: 10px;
        }

        /* Header */
        .header {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
        }

        .header h1 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
        }

        .header p {
            color: #64748b;
            font-size: 0.875rem;
            margin: 0px;
        }

        /* Stats */
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            flex-shrink: 0;
        }

        .stat-card {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #3b82f6;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 500;
        }

        /* Tabs */
        .tabs {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .tab-nav {
            display: flex;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            flex-shrink: 0;
        }

        .tab-btn {
            flex: 1;
            padding: 10px 12px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            color: #64748b;
            transition: all 0.2s ease;
        }

        .tab-btn:hover {
            background: #e2e8f0;
            color: #334155;
        }

        .tab-btn.active {
            background: #ffffff;
            color: #3b82f6;
            border-bottom: 2px solid #3b82f6;
        }

        .tab-content {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .tab-pane {
            display: none;
            flex: 1;
            overflow: hidden;
        }

        .tab-pane.active {
            display: flex;
            flex-direction: column;
        }

        /* Table Container with Scroll */
        .table-container {
            flex: 1;
            overflow: auto;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            margin: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }

        th {
            background: #f8fafc;
            padding: 9px 12px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        td {
            padding: 9px 12px;
            border-bottom: 1px solid #f1f5f9;
        }

        tbody tr:hover {
            background: #f8fafc;
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        /* Shift badges */
        .shift-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .shift-morning {
            background: #fef3c7;
            color: #92400e;
        }

        .shift-evening {
            background: #ddd6fe;
            color: #6b21a8;
        }

        .shift-night {
            background: #e0e7ff;
            color: #3730a3;
        }

        /* Form Section with Scroll */
        .form-section {
            padding: 16px;
            overflow: auto;
            flex: 1;
        }

        .form-section h3 {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 20px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 16px;
            align-items: end;
            margin-bottom: 4px;
        }

        .form-group label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            margin-bottom: 6px;
        }

        .form-control {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
            transition: border-color 0.2s ease;
            background: #ffffff;
        }

        .form-control:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            height: fit-content;
        }

        .btn-primary {
            background: #3b82f6;
            color: #ffffff;
        }

        .btn-primary:hover {
            background: #2563eb;
        }

        .btn-primary:active {
            background: #1d4ed8;
        }

        /* Assignment history */
        .assignment-history {
            margin-top: 24px;
        }

        .assignment-history h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 12px;
        }

        .assignment-item {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 8px;
            font-size: 0.875rem;
        }

        .assignment-item strong {
            color: #0369a1;
        }

        .empty-state {
            text-align: center;
            color: #64748b;
            font-style: italic;
            padding: 32px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 12px;
                gap: 12px;
            }

            .form-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .stats {
                grid-template-columns: 1fr;
            }

            .tab-nav {
                flex-direction: column;
            }

            .table-container {
                margin: 12px;
            }

            .form-section {
                padding: 12px;
            }
        }

        /* Custom scrollbar */
        .table-container::-webkit-scrollbar,
        .form-section::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        .table-container::-webkit-scrollbar-track,
        .form-section::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        .table-container::-webkit-scrollbar-thumb,
        .form-section::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        .table-container::-webkit-scrollbar-thumb:hover,
        .form-section::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Roster Management</h1>
            <p>Manage employee schedules and shift assignments</p>
        </div>

        <!-- Stats -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalEmployees">0</div>
                <div class="stat-label">Total Assignments</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="todayShifts">0</div>
                <div class="stat-label">Today's Shifts</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="weekShifts">0</div>
                <div class="stat-label">This Week</div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <div class="tab-nav">
                <button class="tab-btn active" data-target="roster">Roster Overview</button>
                <button class="tab-btn" data-target="assign">Shift Assignment</button>
            </div>

            <div class="tab-content">
                <!-- Roster Tab -->
                <div id="roster" class="tab-pane active">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Employee</th>
                                    <th>Date</th>
                                    <th>Shift</th>
                                </tr>
                            </thead>
                            <tbody id="rosterTableBody">
                                <tr>
                                    <td colspan="3" class="empty-state">Loading roster data...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Assignment Tab -->
                <div id="assign" class="tab-pane">
                    <div class="form-section">
                        <h3>Assign New Shift</h3>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="shiftDate">Date</label>
                                <input type="date" id="shiftDate" class="form-control">
                            </div>
                            
                            <div class="form-group">
                                <label for="shiftSelector">Shift</label>
                                <select id="shiftSelector" class="form-control">
                                    <option value="">Select Shift</option>
                                    <option value="Morning">Morning (6AM - 2PM)</option>
                                    <option value="Evening">Evening (2PM - 10PM)</option>
                                    <option value="Night">Night (10PM - 6AM)</option>
                                </select>
                            </div>
                            
                            <button class="btn btn-primary" id="assignBtn">Assign</button>
                        </div>

                        <div class="assignment-history">
                            <h4>Recent Assignments</h4>
                            <div id="assignedShifts">
                                <div class="empty-state">No recent assignments</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Generate more sample data to test scrolling
            const rosterData = [];
            const employees = [
                "Alice Johnson", "Bob Smith", "Charlie Brown", "Diana Martinez", "Ethan Davis",
                "Fiona Wilson", "George Taylor", "Hannah Lee", "Ian Moore", "Julia Clark",
                "Kevin Wright", "Linda Adams", "Michael Hall", "Nancy Green", "Oscar King",
                "Paula Baker", "Quinn Nelson", "Rachel White", "Steve Miller", "Tina Lopez"
            ];
            
            const shifts = ["Morning", "Evening", "Night"];
            
            // Generate sample data for the next 30 days
            for (let i = 0; i < 60; i++) {
                const date = new Date();
                date.setDate(date.getDate() + (i % 30));
                const employee = employees[Math.floor(Math.random() * employees.length)];
                const shift = shifts[Math.floor(Math.random() * shifts.length)];
                
                rosterData.push({
                    employee: employee,
                    date: date.toISOString().split('T')[0],
                    shift: shift
                });
            }

            function getShiftBadgeClass(shift) {
                return `shift-${shift.toLowerCase()}`;
            }

            function updateStats() {
                const today = new Date().toISOString().split('T')[0];
                const weekStart = new Date();
                weekStart.setDate(weekStart.getDate() - weekStart.getDay());
                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekEnd.getDate() + 6);

                const todayShifts = rosterData.filter(item => item.date === today).length;
                const weekShifts = rosterData.filter(item => {
                    const itemDate = new Date(item.date);
                    return itemDate >= weekStart && itemDate <= weekEnd;
                }).length;

                document.getElementById('totalEmployees').textContent = rosterData.length;
                document.getElementById('todayShifts').textContent = todayShifts;
                document.getElementById('weekShifts').textContent = weekShifts;
            }

            function renderRoster() {
                const tbody = document.getElementById("rosterTableBody");
                tbody.innerHTML = "";
                
                if (rosterData.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="3" class="empty-state">No roster data available</td></tr>';
                    return;
                }

                rosterData.forEach((item) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td style="font-weight: 500;">${item.employee}</td>
                        <td>${new Date(item.date).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })}</td>
                        <td><span class="shift-badge ${getShiftBadgeClass(item.shift)}">${item.shift}</span></td>
                    `;
                    tbody.appendChild(row);
                });
                
                updateStats();
            }

            renderRoster();

            // Tab switching
            document.querySelectorAll(".tab-btn").forEach((btn) => {
                btn.addEventListener("click", function () {
                    document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
                    this.classList.add("active");

                    document.querySelectorAll(".tab-pane").forEach(p => p.classList.remove("active"));
                    document.getElementById(this.getAttribute("data-target")).classList.add("active");
                });
            });

            // Assign shift
            document.getElementById("assignBtn").addEventListener("click", function () {
                const date = document.getElementById("shiftDate").value;
                const shift = document.getElementById("shiftSelector").value;

                if (!date || !shift) {
                    alert("Please select both date and shift.");
                    return;
                }

                const entry = { employee: "Current User", date, shift };
                rosterData.push(entry);
                renderRoster();

                // Add to recent assignments
                const assignedShifts = document.getElementById("assignedShifts");
                if (assignedShifts.querySelector('.empty-state')) {
                    assignedShifts.innerHTML = '';
                }

                const assignmentDiv = document.createElement("div");
                assignmentDiv.className = "assignment-item";
                assignmentDiv.innerHTML = `
                    <strong>Assignment Successful:</strong> 
                    <span class="shift-badge ${getShiftBadgeClass(shift)}">${shift}</span> shift on 
                    ${new Date(date).toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' })}
                `;
                
                assignedShifts.insertBefore(assignmentDiv, assignedShifts.firstChild);
                
                // Keep only last 3 assignments visible
                while (assignedShifts.children.length > 3) {
                    assignedShifts.removeChild(assignedShifts.lastChild);
                }

                // Clear form
                document.getElementById("shiftDate").value = "";
                document.getElementById("shiftSelector").value = "";
            });

            // Set default date to today
            document.getElementById("shiftDate").value = new Date().toISOString().split('T')[0];
        });
    </script>
</body>
</html>

{% endblock content %}
