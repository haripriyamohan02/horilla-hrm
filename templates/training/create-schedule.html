{% extends 'index.html' %}
{% load static %}
{% load i18n %}

{% block content %}
<!-- Modal Overlay -->
<!-- Modal Overlay -->
<div id="trainingScheduleModal" class="oh-modal-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); display: none; align-items: center; justify-content: center; z-index: 1000;">
    <div class="oh-modal" style="background: #ffffff; border-radius: 8px; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); width: 90%; max-width: 800px; max-height: 90vh; overflow-y: auto;">
        <!-- Modal Header -->
        <div class="oh-modal__header" style="padding: 20px 24px; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center; background: #f9fafb;">
            <h3 style="margin: 0; font-size: 20px; font-weight: 600; color: #111827;">{% trans "Create Training Schedule" %}</h3>
            <button class="oh-modal__close" onclick="closeModal()" style="background: none; border: none; font-size: 24px; color: #6b7280; cursor: pointer; padding: 0; line-height: 1;" onmouseover="this.style.color='#374151'" onmouseout="this.style.color='#6b7280'">Ã—</button>
        </div>

        <!-- Modal Body -->
        <div class="oh-modal__body" style="padding: 24px;">
            <form id="trainingScheduleForm" method="post" action="{% url 'create-training-schedule' %}">
                {% csrf_token %}
                
                <!-- Course Information Section -->
                <div class="oh-form-section" style="margin-bottom: 32px;">
                    <h4 style="margin: 0 0 20px 0; font-size: 16px; font-weight: 600; color: #111827; padding-bottom: 8px; border-bottom: 2px solid #e5e7eb;">{% trans "Course Information" %}</h4>
                    
                    <div class="oh-form-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div class="oh-form-group">
                            <label class="oh-label" style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">
                                {% trans "Course Name" %} <span style="color: #e53e3e;">*</span>
                            </label>
                            <input type="text" name="course_name" required class="oh-input" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; color: #111827; background: #ffffff;" placeholder="{% trans 'Enter course name' %}">
                        </div>
                        
                        <div class="oh-form-group">
                            <label class="oh-label" style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">
                                {% trans "Course Category" %} <span style="color: #e53e3e;">*</span>
                            </label>
                            <select name="course_category" required class="oh-select" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; color: #111827; background: #ffffff;">
                                <option value="">{% trans "Select Category" %}</option>
                                <option value="safety">{% trans "Safety" %}</option>
                                <option value="leadership">{% trans "Leadership" %}</option>
                                <option value="technical">{% trans "Technical" %}</option>
                                <option value="compliance">{% trans "Compliance" %}</option>
                                <option value="soft_skills">{% trans "Soft Skills" %}</option>
                                <option value="management">{% trans "Management" %}</option>
                            </select>
                        </div>
                    </div>

                    <div class="oh-form-group" style="margin-bottom: 20px;">
                        <label class="oh-label" style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">
                            {% trans "Course Description" %}
                        </label>
                        <textarea name="course_description" rows="3" class="oh-textarea" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; color: #111827; background: #ffffff; resize: vertical;" placeholder="{% trans 'Enter course description and objectives' %}"></textarea>
                    </div>
                </div>

                <!-- Schedule Information Section -->
                <div class="oh-form-section" style="margin-bottom: 32px;">
                    <h4 style="margin: 0 0 20px 0; font-size: 16px; font-weight: 600; color: #111827; padding-bottom: 8px; border-bottom: 2px solid #e5e7eb;">{% trans "Schedule Information" %}</h4>
                    
                    <div class="oh-form-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div class="oh-form-group">
                            <label class="oh-label" style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">
                                {% trans "Training Date" %} <span style="color: #e53e3e;">*</span>
                            </label>
                            <input type="date" name="training_date" required class="oh-input" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; color: #111827; background: #ffffff;">
                        </div>
                        
                        <div class="oh-form-group">
                            <label class="oh-label" style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">
                                {% trans "Duration" %} <span style="color: #e53e3e;">*</span>
                            </label>
                            <select name="duration" required class="oh-select" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; color: #111827; background: #ffffff;">
                                <option value="">{% trans "Select Duration" %}</option>
                                <option value="2">{% trans "2 hours" %}</option>
                                <option value="4">{% trans "4 hours" %}</option>
                                <option value="6">{% trans "6 hours" %}</option>
                                <option value="8">{% trans "8 hours" %}</option>
                                <option value="16">{% trans "2 days (16 hours)" %}</option>
                                <option value="24">{% trans "3 days (24 hours)" %}</option>
                            </select>
                        </div>
                    </div>

                    <div class="oh-form-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div class="oh-form-group">
                            <label class="oh-label" style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">
                                {% trans "Start Time" %} <span style="color: #e53e3e;">*</span>
                            </label>
                            <input type="time" name="start_time" required class="oh-input" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; color: #111827; background: #ffffff;">
                        </div>
                        
                        <div class="oh-form-group">
                            <label class="oh-label" style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">
                                {% trans "End Time" %} <span style="color: #e53e3e;">*</span>
                            </label>
                            <input type="time" name="end_time" required class="oh-input" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; color: #111827; background: #ffffff;">
                        </div>
                    </div>

                    <div class="oh-form-group" style="margin-bottom: 20px;">
                        <label class="oh-label" style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">
                            {% trans "Training Location" %} <span style="color: #e53e3e;">*</span>
                        </label>
                        <input type="text" name="location" required class="oh-input" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; color: #111827; background: #ffffff;" placeholder="{% trans 'Enter training venue or room' %}">
                    </div>
                </div>

                <!-- Instructor & Capacity Section -->
                <div class="oh-form-section" style="margin-bottom: 32px;">
                    <h4 style="margin: 0 0 20px 0; font-size: 16px; font-weight: 600; color: #111827; padding-bottom: 8px; border-bottom: 2px solid #e5e7eb;">{% trans "Instructor & Capacity" %}</h4>
                    
                    <div class="oh-form-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div class="oh-form-group">
                            <label class="oh-label" style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">
                                {% trans "Instructor" %} <span style="color: #e53e3e;">*</span>
                            </label>
                            <select name="instructor" required class="oh-select" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; color: #111827; background: #ffffff;">
                                <option value="">{% trans "Select Instructor" %}</option>
                                <option value="dr_sarah_wilson">Dr. Sarah Wilson</option>
                                <option value="michael_chen">Michael Chen</option>
                                <option value="jennifer_adams">Jennifer Adams</option>
                                <option value="david_kumar">David Kumar</option>
                                <option value="lisa_rodriguez">Lisa Rodriguez</option>
                            </select>
                        </div>
                        
                        <div class="oh-form-group">
                            <label class="oh-label" style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">
                                {% trans "Maximum Capacity" %} <span style="color: #e53e3e;">*</span>
                            </label>
                            <input type="number" name="max_capacity" required min="1" max="100" class="oh-input" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; color: #111827; background: #ffffff;" placeholder="{% trans 'Maximum number of trainees' %}">
                        </div>
                    </div>

                    <div class="oh-form-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div class="oh-form-group">
                            <label class="oh-label" style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">
                                {% trans "Prerequisites" %}
                            </label>
                            <textarea name="prerequisites" rows="2" class="oh-textarea" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; color: #111827; background: #ffffff; resize: vertical;" placeholder="{% trans 'Any required qualifications or prior training' %}"></textarea>
                        </div>
                        
                        <div class="oh-form-group">
                            <label class="oh-label" style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">
                                {% trans "Training Materials" %}
                            </label>
                            <textarea name="materials" rows="2" class="oh-textarea" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; color: #111827; background: #ffffff; resize: vertical;" placeholder="{% trans 'Required materials, handouts, or equipment' %}"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Additional Settings Section -->
                <div class="oh-form-section" style="margin-bottom: 32px;">
                    <h4 style="margin: 0 0 20px 0; font-size: 16px; font-weight: 600; color: #111827; padding-bottom: 8px; border-bottom: 2px solid #e5e7eb;">{% trans "Additional Settings" %}</h4>
                    
                    <div class="oh-form-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div class="oh-form-group">
                            <label class="oh-label" style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">
                                {% trans "Registration Deadline" %}
                            </label>
                            <input type="date" name="registration_deadline" class="oh-input" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; color: #111827; background: #ffffff;">
                        </div>
                        
                        <div class="oh-form-group">
                            <label class="oh-label" style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px;">
                                {% trans "Training Cost" %}
                            </label>
                            <input type="number" name="cost" min="0" step="0.01" class="oh-input" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; color: #111827; background: #ffffff;" placeholder="{% trans 'Cost per trainee (optional)' %}">
                        </div>
                    </div>

                    <div class="oh-form-group" style="margin-bottom: 20px;">
                        <div class="oh-checkbox-group" style="display: flex; gap: 24px; flex-wrap: wrap;">
                            <label class="oh-checkbox-label" style="display: flex; align-items: center; gap: 8px; font-size: 14px; color: #374151; cursor: pointer;">
                                <input type="checkbox" name="certification_provided" value="1" style="width: 16px; height: 16px; accent-color: #e53e3e;">
                                {% trans "Certification Provided" %}
                            </label>
                            
                            <label class="oh-checkbox-label" style="display: flex; align-items: center; gap: 8px; font-size: 14px; color: #374151; cursor: pointer;">
                                <input type="checkbox" name="mandatory_training" value="1" style="width: 16px; height: 16px; accent-color: #e53e3e;">
                                {% trans "Mandatory Training" %}
                            </label>
                            
                            <label class="oh-checkbox-label" style="display: flex; align-items: center; gap: 8px; font-size: 14px; color: #374151; cursor: pointer;">
                                <input type="checkbox" name="recurring_training" value="1" style="width: 16px; height: 16px; accent-color: #e53e3e;">
                                {% trans "Recurring Training" %}
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="oh-form-actions" style="padding-top: 20px; border-top: 1px solid #e5e7eb; display: flex; justify-content: flex-end; gap: 12px;">
                    <button type="button" onclick="closeModal()" class="oh-btn oh-btn--secondary" style="background: #ffffff; border: 1px solid #d1d5db; color: #374151; padding: 10px 20px; border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='#ffffff'">
                        {% trans "Cancel" %}
                    </button>
                    <button type="submit" class="oh-btn oh-btn--primary" style="background: #e53e3e; border: none; color: #ffffff; padding: 10px 20px; border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#c53030'" onmouseout="this.style.background='#e53e3e'">
                        {% trans "Create Training Schedule" %}
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
function closeModal() {
    document.getElementById('trainingScheduleModal').style.display = 'none';
}

// Close modal when clicking outside
document.getElementById('trainingScheduleModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeModal();
    }
});

// Form validation and submission
document.getElementById('trainingScheduleForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Basic validation
    const startTime = document.querySelector('input[name="start_time"]').value;
    const endTime = document.querySelector('input[name="end_time"]').value;
    
    if (startTime && endTime && startTime >= endTime) {
        alert('{% trans "End time must be after start time" %}');
        return;
    }
    
    // Submit the form
    this.submit();
});

// Auto-calculate end time based on start time and duration
document.querySelector('select[name="duration"]').addEventListener('change', function() {
    const startTimeInput = document.querySelector('input[name="start_time"]');
    const endTimeInput = document.querySelector('input[name="end_time"]');
    
    if (startTimeInput.value && this.value) {
        const startTime = new Date('2000-01-01 ' + startTimeInput.value);
        const duration = parseInt(this.value);
        const endTime = new Date(startTime.getTime() + (duration * 60 * 60 * 1000));
        
        const endTimeString = endTime.toTimeString().slice(0, 5);
        endTimeInput.value = endTimeString;
    }
});
</script>


<script>
function closeModal() {
    document.getElementById('trainingScheduleModal').style.display = 'none';
}

// Close modal when clicking outside
document.getElementById('trainingScheduleModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeModal();
    }
});

// Form validation and submission
document.getElementById('trainingScheduleForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Basic validation
    const startTime = document.querySelector('input[name="start_time"]').value;
    const endTime = document.querySelector('input[name="end_time"]').value;
    
    if (startTime && endTime && startTime >= endTime) {
        alert('{% trans "End time must be after start time" %}');
        return;
    }
    
    // Here you would typically submit the form data to your backend
    // For now, we'll just show a success message
    alert('{% trans "Training schedule created successfully!" %}');
    closeModal();
    
    // Optionally reload the page or update the training list
    // window.location.reload();
});

// Auto-calculate end time based on start time and duration
document.querySelector('select[name="duration"]').addEventListener('change', function() {
    const startTimeInput = document.querySelector('input[name="start_time"]');
    const endTimeInput = document.querySelector('input[name="end_time"]');
    
    if (startTimeInput.value && this.value) {
        const startTime = new Date('2000-01-01 ' + startTimeInput.value);
        const duration = parseInt(this.value);
        const endTime = new Date(startTime.getTime() + (duration * 60 * 60 * 1000));
        
        const endTimeString = endTime.toTimeString().slice(0, 5);
        endTimeInput.value = endTimeString;
    }
});
</script>
{% endblock %}