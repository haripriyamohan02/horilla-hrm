{% extends 'index.html' %}
{% load static %}
{% load i18n %}

{% block content %}
<div class="oh-card">
    <div class="oh-card__header" style="display: flex; justify-content: space-between; align-items: center;">
        <h4 class="oh-card__title">{% trans "Postings" %}</h4>
        <div class="oh-card__actions">
            <div class="oh-btn-group">
                <a href="#" class="oh-btn oh-btn--primary" onclick="toggleModal('createPostingModal')">
                    <ion-icon name="add-outline" class="mr-2"></ion-icon>
                    {% trans "Create" %}
                </a>
            </div>
        </div>
    </div>
    <div class="oh-card__body">
        <table class="oh-table">
            <thead>
                <tr class="oh-table__row">
                    <th class="oh-table__cell">{% trans "Job Title" %}</th>
                    <th class="oh-table__cell">{% trans "Department" %}</th>
                    <th class="oh-table__cell">{% trans "Location" %}</th>
                    <th class="oh-table__cell">{% trans "Date Posted" %}</th>
                </tr>
            </thead>
            <tbody id="postings-table-body">
                <!-- Rows will be injected by JavaScript -->
            </tbody>
        </table>
    </div>
</div>

<div class="oh-modal" id="createPostingModal">
    <div class="oh-modal__dialog" style="max-width: 800px;">
        <div class="oh-modal__dialog-header">
            <h5 class="oh-modal__dialog-title">{% trans "New Posting" %}</h5>
            <button class="oh-modal__close" onclick="toggleModal('createPostingModal')">&times;</button>
        </div>
        <div class="oh-modal__dialog-content">
            <form id="create-posting-form">
                <div class="row">
                    <div class="col-md-6">
                        <div class="oh-form-group">
                            <label for="position-input" class="oh-label">{% trans "Job Title" %} *</label>
                            <input type="text" id="position-input" class="oh-input" placeholder="Enter job title">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="oh-form-group">
                            <label for="department-input" class="oh-label">{% trans "Department" %} *</label>
                            <input type="text" id="department-input" class="oh-input" placeholder="Enter department">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="oh-form-group">
                            <label for="location-input" class="oh-label">{% trans "Location" %} *</label>
                            <input type="text" id="location-input" class="oh-input" placeholder="Enter location">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="oh-form-group">
                            <label for="start-date-input" class="oh-label">{% trans "Date Posted" %} *</label>
                            <input type="date" id="start-date-input" class="oh-input">
                        </div>
                    </div>
                </div>
                <div class="oh-modal__dialog-footer">
                    <button type="button" class="oh-btn oh-btn--secondary" onclick="toggleModal('createPostingModal')">{% trans "Cancel" %}</button>
                    <button type="submit" class="oh-btn oh-btn--primary">{% trans "Create" %}</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    function toggleModal(modalID) {
        document.getElementById(modalID).classList.toggle('oh-modal--show');
    }

    function renderPostingsTable() {
        const postings = getPostings();
        const tableBody = document.getElementById('postings-table-body');
        tableBody.innerHTML = '';

        postings.forEach(p => {
            const row = tableBody.insertRow();
            row.innerHTML = `
                <td>${p.position_name}</td>
                <td>${p.department}</td>
                <td>${p.location}</td>
                <td>${p.start_date}</td>
            `;
        });
    }

    document.getElementById('create-posting-form').addEventListener('submit', function (e) {
        e.preventDefault();
        const newPosting = {
            position_name: document.getElementById('position-input').value,
            department: document.getElementById('department-input').value,
            location: document.getElementById('location-input').value,
            start_date: document.getElementById('start-date-input').value,
        };

        if (!newPosting.position_name) return;
        
        addPosting(newPosting);
        document.getElementById('create-posting-form').reset();
        toggleModal('createPostingModal');
        renderPostingsTable();
    });

    document.addEventListener('DOMContentLoaded', renderPostingsTable);
</script>
{% endblock %} 