{% extends 'index.html' %}
{% load static %}
{% load i18n %}

{% block content %}
<style>
    .oh-input:focus,
    select.oh-input:focus {
        outline: none;
        border-color: #80bdff;
        box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
    }
    
    select.oh-input {
        appearance: auto;
        background-color: #fff;
        cursor: pointer;
        border: 1px solid #ced4da;
    }

    select.oh-input:hover {
        border-color: #80bdff;
    }
</style>

<div class="oh-wrapper m-0" style="max-width: 100%;">
    <div class="oh-content">
        <div class="oh-row">
            <div class="oh-card bg-transparent">
                <!-- Updated header with better alignment matching the second image -->
                <div class="d-flex align-items-center justify-content-between mb-3" style="gap: 16px;">
                    <h4 class="oh-card__title mb-0" style="font-weight: 600; white-space: nowrap; min-width: fit-content;">Postings</h4>
                    
                    <div class="d-flex align-items-center" style="gap: 12px; flex: 1; justify-content: flex-end;">
                        <!-- Search Input -->
                        <div class="input-group" style="max-width: 300px;">
                            <!-- <span class="input-group-text bg-white border-end-0" style="border-radius: 4px 0 0 4px; border: 1.5px solid #ced4da; border-right: none; padding: 8px 12px;">
                                <ion-icon name="search-outline" style="font-size: 16px; color: #666;"></ion-icon>
                            </span> -->
                            <input type="text" class="form-control oh-input border-start-0" placeholder="Search" style="border-radius: 4px 4px 4px 4px; border: 1.5px solid #ced4da;">
                        </div>
                        
                        <!-- Filter Button -->
                        <button class="oh-btn oh-btn--secondary d-flex align-items-center" style="background: #f5f5f5; color: #222; border: 1.5px solid #e0e0e0; font-weight: 500; white-space: nowrap;">
                            <ion-icon name="filter-outline" style="margin-right: 6px; font-size: 16px;"></ion-icon> Filter
                        </button>
                        
                        <!-- Group By Button -->
                        <button class="oh-btn oh-btn--secondary d-flex align-items-center" style="background: #f5f5f5; color: #222; border: 1.5px solid #e0e0e0; font-weight: 500; white-space: nowrap;">
                            <ion-icon name="bar-chart-outline" style="margin-right: 6px; font-size: 16px;"></ion-icon> Group By
                        </button>
                        
                        <!-- Create Button -->
                        <button class="oh-btn oh-btn--primary" style="background-color: #ff3b38; border-color: #ff3b38; font-weight: 600; white-space: nowrap; min-width: fit-content;" onclick="toggleModal('createPostingModal')">
                            <ion-icon name="add-outline" style="margin-right: 6px; font-size: 16px;"></ion-icon>
                            Create
                        </button>
                    </div>
                </div>
    <div class="oh-card__body">
        <table class="oh-table">
            <thead>
                <tr class="oh-table__row">
                    <th class="oh-table__cell" style="font-size: 13px;">{% trans "Job Title" %}</th>
                    <th class="oh-table__cell" style="font-size: 13px;">{% trans "Department" %}</th>
                    <th class="oh-table__cell" style="font-size: 13px;">{% trans "Location" %}</th>
                    <th class="oh-table__cell" style="font-size: 13px;">{% trans "Vacancy" %}</th>
                    <th class="oh-table__cell" style="font-size: 13px;">{% trans "Date Posted" %}</th>
                </tr>
            </thead>
            <tbody id="postings-table-body">
                <!-- Rows will be injected by JavaScript -->
            </tbody>
        </table>
    </div>
</div>

<div class="oh-modal" id="createPostingModal">
    <div class="oh-modal__dialog" style="max-width: 600px; width: 90%; background: white; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); max-height: 85vh; overflow-y: auto; margin-top: 6%;">
        <div class="oh-modal__dialog-header" style="padding: 15px 20px; border-bottom: 1px solid #e9ecef;">
            <h5 class="oh-modal__dialog-title" style="margin: 0; font-size: 16px; font-weight: 600; color: #333;">{% trans "New Posting" %}</h5>
            <button class="oh-modal__close" onclick="toggleModal('createPostingModal')" style="background: none; border: none; font-size: 20px; cursor: pointer; color: #666; position: absolute; top:11px; right: 15px;">&times;</button>
        </div>
        <div class="oh-modal__dialog-body" style="padding: 15px 20px;">
            <form id="create-posting-form">
                <div class="row" style="display: flex; margin: 0 -8px; margin-bottom: 15px;">
                    <div class="col-md-6" style="flex: 0 0 50%; padding: 0 8px;">
                        <div class="oh-form-group" style="margin-bottom: 0;">
                            <label for="position-input" class="oh-label" style="display: block; margin-bottom: 6px; font-weight: 500; color: #333; font-size: 13px;">{% trans "Job Title" %} *</label>
                            <input type="text" id="position-input" class="oh-input" placeholder="Enter job title" style="width: 100%; padding: 8px 10px; border: 1px solid #ced4da; border-radius: 4px; font-size: 13px;">
                        </div>
                    </div>
                    <div class="col-md-6" style="flex: 0 0 50%; padding: 0 8px;">
                        <div class="oh-form-group" style="margin-bottom: 0;">
                            <label for="department-input" class="oh-label" style="display: block; margin-bottom: 6px; font-weight: 500; color: #333; font-size: 13px;">{% trans "Department" %} *</label>
                            <input type="text" id="department-input" class="oh-input" placeholder="Enter department" style="width: 100%; padding: 8px 10px; border: 1px solid #ced4da; border-radius: 4px; font-size: 13px;">
                        </div>
                    </div>
                </div>
                <div class="row" style="display: flex; margin: 0 -8px; margin-bottom: 15px;">
                    <div class="col-md-6" style="flex: 0 0 50%; padding: 0 8px;">
                        <div class="oh-form-group" style="margin-bottom: 0;">
                            <label for="location-input" class="oh-label" style="display: block; margin-bottom: 6px; font-weight: 500; color: #333; font-size: 13px;">{% trans "Location" %} *</label>
                            <input type="text" id="location-input" class="oh-input" placeholder="Enter location" style="width: 100%; padding: 8px 10px; border: 1px solid #ced4da; border-radius: 4px; font-size: 13px;">
                        </div>
                    </div>
                    <div class="col-md-6" style="flex: 0 0 50%; padding: 0 8px;">
                        <div class="oh-form-group" style="margin-bottom: 0;">
                            <label for="vacancy-input" class="oh-label" style="display: block; margin-bottom: 6px; font-weight: 500; color: #333; font-size: 13px;">{% trans "Vacancy" %} *</label>
                            <input type="number" id="vacancy-input" class="oh-input" placeholder="Enter vacancy count" min="1" style="width: 100%; padding: 8px 10px; border: 1px solid #ced4da; border-radius: 4px; font-size: 13px;">
                        </div>
                    </div>
                </div>
                <div class="row" style="display: flex; margin: 0 -8px; margin-bottom: 15px;">
                    <div class="col-md-6" style="flex: 0 0 50%; padding: 0 8px;">
                        <div class="oh-form-group" style="margin-bottom: 0;">
                            <label for="start-date-input" class="oh-label" style="display: block; margin-bottom: 6px; font-weight: 500; color: #333; font-size: 13px;">{% trans "Date Posted" %} *</label>
                            <input type="date" id="start-date-input" class="oh-input" style="width: 100%; padding: 8px 10px; border: 1px solid #ced4da; border-radius: 4px; font-size: 13px;">
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <div class="oh-modal__dialog-footer" style="padding: 12px 20px; border-top: 1px solid #e9ecef; display: flex; justify-content: flex-end; gap: 8px;">
            <!-- <button type="button" class="oh-btn oh-btn--secondary" onclick="toggleModal('createPostingModal')" style="padding: 6px 12px; font-size: 13px;">{% trans "Cancel" %}</button> -->
            <button type="submit" form="create-posting-form" class="oh-btn oh-btn--primary" style="padding: 6px 12px; font-size: 13px; background-color: #ff3b38;">{% trans "Create" %}</button>
        </div>
    </div>
</div>

<script>
    function toggleModal(modalID) {
        document.getElementById(modalID).classList.toggle('oh-modal--show');
    }

    function getPostings() {
        return JSON.parse(localStorage.getItem('horillaPostings') || '[]');
    }

    function renderPostingsTable(filteredPostings) {
        const postings = filteredPostings || getPostings();
        const tableBody = document.getElementById('postings-table-body');
        tableBody.innerHTML = '';

        postings.forEach(p => {
            const row = tableBody.insertRow();
            row.innerHTML = `
                <td style="font-size: 13px;">${p.position_name}</td>
                <td style="font-size: 13px;">${p.department}</td>
                <td style="font-size: 13px;">${p.location}</td>
                <td style="font-size: 13px;">${p.vacancy || ''}</td>
                <td style="font-size: 13px;">${p.start_date}</td>
            `;
        });
    }

    function filterPostingsTable() {
        const searchValue = document.querySelector('.input-group input[type="text"]').value.toLowerCase();
        const postings = getPostings();
        const filtered = postings.filter(p =>
            p.position_name.toLowerCase().includes(searchValue) ||
            p.department.toLowerCase().includes(searchValue) ||
            p.location.toLowerCase().includes(searchValue)
        );
        renderPostingsTable(filtered);
    }

    document.getElementById('create-posting-form').addEventListener('submit', function (e) {
        e.preventDefault();
        const newPosting = {
            position_name: document.getElementById('position-input').value,
            department: document.getElementById('department-input').value,
            location: document.getElementById('location-input').value,
            start_date: document.getElementById('start-date-input').value,
            vacancy: document.getElementById('vacancy-input').value,
        };

        if (!newPosting.position_name) return;
        
        addPosting(newPosting);
        document.getElementById('create-posting-form').reset();
        toggleModal('createPostingModal');
        renderPostingsTable();
    });

    document.addEventListener('DOMContentLoaded', function() {
        renderPostingsTable();
        document.querySelector('.input-group input[type="text"]').addEventListener('keyup', filterPostingsTable);
    });
</script>

{% endblock %} 